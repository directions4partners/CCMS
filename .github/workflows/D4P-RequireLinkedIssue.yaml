name: '_Require linked issue'

on:
  pull_request_target:
    types: [opened, edited, reopened, synchronize]

jobs:
  require-linked-issue:
    runs-on: ubuntu-latest

    steps:
      - name: Check PR body for linked issue
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          echo "Checking PR description for linked issues…"
          
          if [ -z "$PR_BODY" ]; then
            echo "❌ PR description is empty. Please add a description with a linked issue (e.g. 'Closes #123')."
            exit 1
          fi
          
          # Look for standard closing keywords followed by an issue reference: #<number>
          if echo "$PR_BODY" | grep -Ei '(close[sd]?|fix(e[sd])?|resolve[sd]?) #[0-9]+' > /dev/null; then
            echo "✅ Found a linked issue in the PR description."
            exit 0
          else
            echo "❌ No linked issue found in PR description."
            echo "   Please add something like: 'Closes #123', 'Fixes #456', or 'Resolves #789'."
            exit 1
          fi
